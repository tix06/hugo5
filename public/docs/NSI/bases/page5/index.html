<!DOCTYPE html>




<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  
    
    projet SQL
  
 | Allophysique</title>


<link href="https://fonts.googleapis.com/css?family=Oxygen|Oxygen+Mono:300,400,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Roboto+Condensed" rel="stylesheet"> 


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>



<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.0/prism.min.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-167114468-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167114468-1');
</script>





<link rel="stylesheet" href="/book.min.757bde8284addd9205931692e0522a4e50ed085e00c44dff802d2fc8255c68ca.css">


<link rel="icon" href="/favicon.png" type="image/x-icon">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  

<div class="my-header-container">
<div class="my-site-header">
	<img src="/logo-site-b.svg" width = "150 px"/>
</div>

<div id="myHeader">
	<div class="titre">
	<h2><a href="/">Allophysique</a></h2>
    </div>
</div>
</div>



<script async>
window.onload = function () {
let container = document.getElementsByClassName("book-page");
let logodiv = document.getElementsByClassName("site-menu-before");
let header = document.getElementById("myHeader");
let screen = window.innerWidth;
let site_footer = document.querySelector(".site_footer");

try {
  
  let site_TOC = document.querySelector("#TableOfContents>ul");
  let newP = document.createElement('li');

  newP.textContent='Contenu de la page';
  site_TOC.appendChild(newP,null);
}
catch(err)
{
    console.log(err.message);
}




if (site_footer.parentNode != document.body){
    let father = site_footer.parentNode;
    let clone = site_footer.cloneNode;
    father.removeChild(site_footer);
    document.body.appendChild(clone);
}





if (screen<=850) {

  document.getElementsByClassName("my-site-header")[0].style.display="none";
} else {

	window.addEventListener("scroll", function(e) {
	let spectral=document.getElementById("spectral");
	if (screen>850 ){
		if (window.pageYOffset > 150) {
			header.classList.add("sticky");
    		if (container.lenght>0) {container[0].style.marginTop="65px";};
            logodiv[0].style.height="120px";
    	} else {
    	header.classList.remove("sticky");
    	if (container.lenght>0) {container[0].style.marginTop="0px";};
    	spectral.style.display="none";
        logodiv[0].style.height="220px";
    	}

    } 
    if (screen<=850) {

    	if (window.pageYOffset > 150){
    		spectral.style.display="block";
    	} else {
    		spectral.style.display="none";
    	}
    }
});
}


}





 
let chemin = window.location.pathname;
if (chemin.search('NSI')>-1) {
baniere=document.querySelector("#myHeader");


let linkBox = document.createElement('div');
linkBox.classList.add('linkBox');
let newH = document.createElement('a');
newH.innerHTML='<a href="/docs/NSI_1/NSI_index/index.html">NSI</a>';

newH.classList.add('nsi');

linkBox.appendChild(newH);
baniere.appendChild(linkBox); 
}
</script>

<style>
  #myHeader{
    display:flex;
    flex-direction: row-reverse;
  }
  #myHeader>.titre{
    width:80%;
    min-width:300px;
    text-align: left;

    
  }
  .linkBox{
    margin:10px;
    padding-top:10px;
    background-color: pink;
    
    min-width:50px;

  }
  .isn{
     
    
  }
</style>



</head>

<body>
  <input type="checkbox" style="display: none" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      
<nav role="navigation">

<div class="site-menu-before" style="height:220px; display:block;" >
<img src="/logo-site.svg" id="spectral" height="50%" style="display:none;">	

</div>



    
  
  
  

  <style>
  nav ul a[href$="\2f docs\2fNSI\2f bases\2fpage5\2f "] {
      color: #004ed0;
  }
  </style>

<ul>
<li>
<p><a href="/"><strong>Accueil</strong></a></p>
</li>
<li>
<p><a href="/docs/SNT_2nde/SNT_index/"><strong>SNT secondes</strong></a></p>
</li>
<li>
<p><a href="/docs/NSI_1/NSI_index/"><strong>NSI 1ere</strong></a></p>
</li>
<li>
<p><a href="/docs/NSI/NSI_index/"><strong>NSI Term</strong></a></p>
</li>
<li>
<p><a href="/docs/PC_2nde/PC_index/"><strong>Physique Chimie 2nde</strong></a></p>
</li>
<li>
<p><a href="/docs/PC_1ere/PC_index/"><strong>Physique 1ere Spé</strong></a></p>
</li>
<li>
<p><a href="/docs/esf/esf_index/"><strong>ESF</strong></a></p>
</li>
<li>
<p><a href="/docs/python/index_python_D/"><strong>Python debutant</strong></a></p>
</li>
<li>
<p><a href="/docs/python/index_python/"><strong>Python avancé</strong></a></p>
</li>
<li>
<p><a href="/docs/techno/index_microcontroleurs/"><strong>Techno</strong></a></p>
</li>
<li>
<p><a href="/posts/"><strong>Posts</strong></a></p>
</li>
<li>
<p><a href="/docs/contact/simple-contact-form/"><strong>Contact</strong></a></p>
</li>
</ul>





</nav>



  
<script>
(function() {
  var menu = document.querySelector('aside.book-menu nav')
  addEventListener('beforeunload', function(event) {
    localStorage.setItem('menu.scrollTop', menu.scrollTop)
  });
  menu.scrollTop = localStorage.getItem('menu.scrollTop')
})()
</script>



    </aside>

    <div class="book-page">
      <header class="align-center justify-between book-header">

  <label for="menu-control">
    <img src="/svg/menu.svg" alt="Menu" />
  </label>
  <strong>
  
    
    projet SQL
  
</strong>
</header>

      
<article class="markdown"><h1 id="serveur-sql">Serveur SQL</h1>
<h2 id="necessité-dune-interface">Necessité d&rsquo;une interface</h2>
<p>Nous avons utilisé le programme SQLite, ou SQLiteBrowser pour faire interface entre l&rsquo;utilisateur et la base de données, sur le modèle suivant:</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Selon cette architecture, lorsque vous recherchez un billet de train, vous utilisez un logiciel qui fera directement l&rsquo;interface:</p>
<p>À titre d’exemple, considérons une application fictive de recherche d’horaires de train.</p>
<!-- raw HTML omitted -->
<p>Voici un scénario possible de fonctionnement de cette application :</p>
<ol>
<li>L’application demande à l’utilisateur : « Quelle est la ville de départ ? ».</li>
<li>L’utilisateur répond « Caussade ».</li>
<li>L’application demande à l’utilisateur : « Quelle est la ville d’arrivée ? ».</li>
<li>L’utilisateur répond « Brive-la-Gaillarde ».</li>
<li>L’application envoie au SGBD la requête SQL :</li>
</ol>
<pre tabindex="0"><code>SELECT heureDep, heureArr FROM trains
WHERE villeDep = ’Caussade’ AND villeArr = ’Brive-la-Gaillarde’;
</code></pre><ol start="6">
<li>Le SGBD répond au programme en envoyant l’ensemble de tuples {(15h47, 17h22); (18h21, 19h58)}</li>
<li>Le programme affiche à l’utilisateur : Résultats pour le trajet Caussade -&gt; Brive-la-Gaillarde</li>
</ol>
<pre tabindex="0"><code>Premier train : 15h47 -&gt; 17h22
Second train : 18h21 -&gt; 19h58
</code></pre><p>Ce scenario semble plausible. En réalité, nous verrons qu&rsquo;il y a une couche intermédiaire de plus: l&rsquo;<em>application web</em>, côté <em>serveur</em>.</p>
<h2 id="architecture-client-serveur-web">Architecture Client-Serveur Web</h2>
<p>Le serveur et ses clients sont des applications distinctes qui s&rsquo;échangent des informations. Lorsque la connexion est établie, l&rsquo;application cliente peut interroger le serveur en lui envoyant une requête (une instruction).</p>
<p>Il s&rsquo;agit par exemple de demander une page web. Mais il peut aussi s&rsquo;agir d&rsquo;un besoin de services mettant en jeu la lecture, suppression ou modification d&rsquo;une information dans une base de données.</p>
<p>Le serveur exécute alors la requête en recherchant les données correspondantes dans la base, puis il expédie en retour une certaine réponse au client. Il compose la page web avant de la distribuer au client s&rsquo;il s&rsquo;agissait d&rsquo;un protocole <em>http</em>.</p>
<p>La communication entre le client et le serveur est donc faite de requêtes et de réponses.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><strong>Un serveur web</strong> est une application qui s&rsquo;execute sur une machine et qui ecoute un port specifique.</p>
<p><strong>Une application web</strong> est un programme stocké sur un serveur distant auquel on accede via une connexion au reseau, via <em>http</em>. Celui-ci peut faire interface avec une base de données, fabrique les pages web à la volée pour le client. Ce client a besoin d&rsquo;un <em>navigateur</em> pour se connecter à cette application web. L&rsquo;application web utilise comme langage de programmation un langage dédié, comme <em>Python, PHP, node, C, ou autre</em>.<!-- raw HTML omitted -->
Alors que la ressource côté client est, elle, programmée en <em>HTML, Javascript, et CSS</em>.</p>
<!-- raw HTML omitted -->
<h2 id="un-exemple-de-page-statique">Un exemple de page <em>statique</em></h2>
<p>Le fichier suivant, <a href="/scripts/server_py/formulaire.txt">formulaire.txt</a> génère un formulaire. Lorsque l&rsquo;on appuie sur le bouton, les valeurs des champs <em>nom</em> et <em>pass</em> sont transmises par methode <em>POST</em>.</p>
<!-- raw HTML omitted -->
<p>Mais ici, ces valeurs ne peuvent pas être récupérées. Cela nécessiterait un script écrit en langage serveur. (voir plus haut).</p>
<p>Vous pouvez ouvrir ce fichier en le télechargeant dans vos documents, puis:</p>
<ul>
<li>changer l&rsquo;extension .txt =&gt; .html</li>
<li>ouvrir avec votre navigateur web</li>
</ul>
<h2 id="serveur-python">Serveur Python</h2>
<h3 id="librairie-httpserver">Librairie http.server</h3>
<p>Il est possible d&rsquo;écrire en Python une application web. Le plus simple est d&rsquo;utiliser les librairies <code>http.server</code> et <code>cgi</code>, directement intégrées au langage.</p>
<p>Une fois le script <a href="/scripts/server_py/server.py">server.py</a> lancé, le client pourra se connecter au serveur local à l&rsquo;adresse <code>http://localhost:8800</code>.</p>
<blockquote>
<p>Pour lancer votre serveur local, télécharger, et mettre dans vos documents le fichier <em>server.py</em>, puis executer à partir d&rsquo;un IDE comme <em>Spyder</em> par exemple.</p>
</blockquote>
<h3 id="librairie-cgi">Librairie cgi</h3>
<p>L&rsquo;utilisation d&rsquo;un formulaire ou la création de pages web dynamique nécessite d&rsquo;importer la librairie <code>cgi</code>.</p>
<p>Les instructions de création de la page web seront mises dans un fichier d&rsquo;extension <code>.py</code>.</p>
<p>Pour que le serveur compile et exécute le code source de votre <em>fichier.py</em>, il faudra naviguer vers ce fichier grâce à l&rsquo;URL <code>http://localhost:8800/fichier.py</code>.</p>
<p>Dans ce fichier, <code>CGI</code> permet de générer des pages web sur le champ, en fonction des actions du client. (Par exemple le chargement du formulaire lors de l&rsquo;appui sur le bouton).</p>
<p>Il suffira d&rsquo;utiliser la fonction <code>print</code> pour afficher les éléments <em>HTML</em> dans la page du <em>client</em>.</p>
<blockquote>
<p>A vous de tester: Dans un fichier que vous nommerez <code>store.py</code>:</p>
</blockquote>
<blockquote>
<ul>
<li>Mettre les lignes suivantes dans le fichier:</li>
</ul>
</blockquote>
<blockquote>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></blockquote>
<h1 id="coding-utf-8">coding: utf-8</h1>
<p>#! /usr/bin/python
import cgi
import cgitb
import html
cgitb.enable()</p>
<p>form = cgi.FieldStorage()
print(&ldquo;Content-type: text/html; charset=utf-8\n&rdquo;)</p>
<p>titre_formulaire = &ldquo;<!-- raw HTML omitted -->Entrez les identifiants des clients<!-- raw HTML omitted -->&rdquo;</p>
<p>titre_table = &ldquo;<!-- raw HTML omitted -->Table clients<!-- raw HTML omitted -->&rdquo;</p>
<p>html1 = &quot;&quot;&quot;
&quot;&quot;&quot;</p>
<p>html2 = &quot;&quot;&quot;
&quot;&quot;&quot;</p>
<p>html3 = &quot;&quot;&quot;
&quot;&quot;&quot;</p>
<p>print(html1)
print(titre_formulaire)
print(html2)
print(titre_table)
print(html3)</p>
<pre tabindex="0"><code>
&gt; * Ajouter les instructions en HTML entre les guillemets affectés à html1, html2 et html3 (partager le script html en 3 parties).
* Demander l&#39;execution du script à l&#39;aide du navigateur. Le formulaire affiché doit être identique à celui de la page *formulaire.html* précédent.



## Python + SQL
Contenant son propre SGBDR intégré, Python dispose de manière native de la librairie `sqlite3` au moment de l&#39;écriture de ce TP. Il faudra importer ce module avec par exemple:
</code></pre><p>import sqlite3 as lite</p>
<pre tabindex="0"><code>

Puis créer un objet-connexion vers la base de données `clients.db`, à l&#39;aide de la fonction-fabrique `connect()`:  
</code></pre><p>con = lite.connect(&lsquo;clients.db&rsquo;)</p>
<pre tabindex="0"><code>
Cet objet assurera l&#39;interface entre votre programme et la base de données.

Pour dialoguer en SQL avec cet objet *con*, on utilisera encore un autre objet-interface que l&#39;on appelle un *curseur*. Il s&#39;agit d&#39;une sorte de tampon mémoire intermédiaire, destiné à mémoriser temporairement les données en cours de traitement, ainsi que les opérations que vous effectuez sur elles, avant leur transfert définitif dans la base de données. Cette technique permet d&#39;annuler et de revenir en arrière dans le traitement, sans que la base de données n&#39;en soit affectée.
</code></pre><p>cur = con.cursor()</p>
<pre tabindex="0"><code>
La requête est exprimée dans une chaîne de caractères, que nous transmettons au curseur par l&#39;intermédiaire de sa méthode `execute()`:
</code></pre><p>cur.execute(&ldquo;CREATE TABLE IF NOT EXISTS clients_login(id INTEGER, name TEXT, pass TEXT)&rdquo;)</p>
<pre tabindex="0"><code>
Tant que le curseur reste ouvert, vous pouvez bien entendu ajouter des enregistrements supplémentaires :
</code></pre><p>cur.execute(&ldquo;INSERT INTO clients_login VALUES(1,?,?)&rdquo;,(nom,mdp))</p>
<pre tabindex="0"><code>
Il sera souvent necessaire d&#39;utiliser les contenus de variables python. Il est cependant fortement déconseillé de faire appel aux techniques ordinaires de formatage des chaînes, car cela peut ouvrir une faille de sécurité dans vos programmes, en y autorisant les intrusions par la méthode de piratage connue sous le nom de *SQL injection*. D&#39;où la séquence d&#39;instruction: `VALUES(1,?,?)&#34;,(nom,mdp))`.

Pour récuperer le contenu d&#39;une table de la base de données: La méthode `Fetchall` (est )une alternative à `Fetchone`), permet de récupérer d&#39;un coup l&#39;ensemble du résultat d&#39;une requête:
</code></pre><p>rows = cur.fetchall</p>
<pre tabindex="0"><code>
La variable `rows` est alors une liste de listes. (les n-uplets de la table)

Le transfert dans la base de données sera déclenché par la méthode `commit` de l&#39;objet connexion :
</code></pre><p>conn.commit()</p>
<pre tabindex="0"><code>

&gt; A vous de jouer:


&gt; * Ajouter la librairie `sqlite3`

&gt; * Ajouter les lignes suivantes après avoir défini le `Content-type` du document client:

&gt; ```python
con = None
con = lite.connect(&#39;clients.db&#39;)
with con:
    cur = con.cursor()
    cur.execute(&#34;CREATE TABLE IF NOT EXISTS clients_login(id INTEGER, name TEXT, pass TEXT, PRIMARY KEY(id AUTOINCREMENT))&#34;)
    cur.execute(&#34;SELECT * FROM clients_login&#34;)
    rows = cur.fetchall()
</code></pre><blockquote>
<ul>
<li>Ajouter les instructions Python de lecture des champs du formulaire à l&rsquo;aide de la fonction <code>form.getvalue</code>, ainsi que l&rsquo;echange avec la base de données:</li>
</ul>
</blockquote>
<blockquote>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"></code></pre></div></blockquote>
<p>if (form.getvalue(&ldquo;name&rdquo;) != None) :
nom = html.escape(form.getvalue(&ldquo;name&rdquo;))
mdp = html.escape(form.getvalue(&ldquo;pass&rdquo;))</p>
<pre><code>with con:
    cur = con.cursor()
    cur.execute(&quot;INSERT INTO clients_login (name,pass) VALUES(?,?)&quot;,(nom,mdp))
    con.commit()
</code></pre>
<pre tabindex="0"><code>
&gt; * Ajouter à l&#39;interieur de cette structure conditionnelle les instructions qui modifieront la variable `titre_paragraphe`. On veut afficher en tête de page:

&gt;  Soit:  &lt;span style=&#34;font-size: 24px;&#34;&gt;Entrez les identifiants des clients&lt;/span&gt; Lorsque les champs de formulaire sont vides.

&gt; &lt;figure&gt;
&lt;div&gt;
  &lt;img src=&#34;../images/page2.png&#34;&gt;
  &lt;figcaption&gt;champs du formulaire video&lt;/figcaption&gt;
&lt;/div&gt;
&lt;/figure&gt;

&gt;   Soit:  &lt;span style=&#34;font-size: 24px;&#34;&gt;VALIDER la saisie: {} =&gt; {}&lt;/span&gt; Lorsque les champs *name* et *pass* ont été renseignés. Les symboles `{}` devront être remplacés par leur valeur à l&#39;aide d&#39;une expression formatée en python. (utiliser `.format`).

&gt; &lt;figure&gt;
&lt;img src=&#34;../images/page3.png&#34;&gt;
  &lt;figcaption&gt;champs du formulaire renseigné&lt;/figcaption&gt;
&lt;/figure&gt;

&gt; * Enfin, modifier la variable `table_affiche` pour afficher dans le tableau TOUS les éléments de la table `clients_login`

&gt; ```python
table_affiche = &#39;&lt;h2&gt;Table clients&lt;/h2&gt;&lt;table border=1&gt;&lt;tr&gt;&#39;
  
table_affiche += &#39;&lt;td&gt;ID&lt;/td&gt;&lt;td&gt;nom&lt;/td&gt;&lt;td&gt;Pass&lt;/td&gt;&#39;
table_affiche+= &#39;&lt;/tr&gt;&#39;
for row in rows:
    table_affiche += &#39;&lt;tr&gt;&#39;
    for i in row:
        table_affiche += &#39;&lt;td&gt;&#39;+str(i)+&#39;&lt;/td&gt;&#39;
    table_affiche += &#39;&lt;/tr&gt;&#39;
table_affiche += &#39;&lt;/table&gt;&#39;
</code></pre><h1 id="mini-projet">Mini projet</h1>
<p>A partir de la base de données du TP précédent, vous allez créer une nouvelle page utilisant des boutons radio.
Ces boutons radio permettront de choisir les noms clients à afficher, en partageant l&rsquo;alphabet en 3 parties.
La page devrait ressembler à l&rsquo;image ci-dessous:</p>
<!-- raw HTML omitted -->
<p><strong>Aide :</strong> <a href="https://developer.mozilla.org/fr/docs/Web/HTML/Element/Input/radio">Boutons radio sur mozzila.com</a></p>
<h1 id="frameworks-flask-et-django">Frameworks Flask et Django</h1>
<p>Pour des projets d&rsquo;applications web plus conséquents, on pourra se tourner vers des frameworks qui vont créer un environnement de travail plus complet:</p>
<ul>
<li>Flask</li>
<li>Django</li>
<li>Pyramid</li>
</ul>
<p>Une presentation plus complète des différences entre ces frameworks ici: <a href="https://www.airpair.com/python/posts/django-flask-pyramid">Django vs Flask vs Pyramid: Choosing a Python Web Framework</a></p>
<!-- raw HTML omitted -->
<h1 id="ressources">Ressources</h1>
<ul>
<li>python flask <a href="https://pixees.fr/informatiquelycee/n_site/nsi_prem_flask.html">pixees</a></li>
<li>python formulaire GET POST <a href="https://developer.mozilla.org/fr/docs/Learn/Forms/Sending_and_retrieving_form_data">developper.mozilla.org</a></li>
<li>python django <a href="https://docs.djangoproject.com/fr/3.1/topics/forms/">formulaires</a></li>
<li>Python et SGBD, les bonnes pratiques: <a href="https://python.developpez.com/cours/apprendre-python3/?page=page_18">python.developpez.com</a></li>
<li>correction du <a href="/scripts/server_py/store_copy.py">TP partie 1</a></li>
<li>correction du <a href="/scripts/server_py/liste.py">TP partie 2</a></li>
</ul>
</article>

      

      <div style="height:100px;"></div>



    </div>

    
  

  
  <aside class="book-toc fixed">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#necessité-dune-interface">Necessité d&rsquo;une interface</a></li>
    <li><a href="#architecture-client-serveur-web">Architecture Client-Serveur Web</a></li>
    <li><a href="#un-exemple-de-page-statique">Un exemple de page <em>statique</em></a></li>
    <li><a href="#serveur-python">Serveur Python</a>
      <ul>
        <li><a href="#librairie-httpserver">Librairie http.server</a></li>
        <li><a href="#librairie-cgi">Librairie cgi</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </aside>



  </main>
  
  

<div class="site_footer">
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Licence Creative Commons" style="border-width:0" src="/creative.png" /></a>


<span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Sciences numeriques</span> de <a xmlns:cc="http://creativecommons.org/ns#" href="" property="cc:attributionName" rel="cc:attributionURL">numerix.netlify.com</a> est mis à disposition selon les termes de la <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">licence Creative Commons Attribution 4.0 International</a>



</div>
  
</body>

</html>
